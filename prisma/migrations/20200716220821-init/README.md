# Migration `20200716220821-init`

This migration has been generated by Ahmed Elywa at 7/16/2020, 10:08:21 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "JobStatus" AS ENUM ('RUNNING', 'STARTING', 'SUCCESS', 'FAILURE', 'TERMINATED', 'ON_ICE', 'INACTIVE', 'ACTIVATED', 'RESTART', 'ON_HOLD', 'QUE_WAIT', 'WAIT_REPLY', 'PEND_MACH', 'RESWAIT', 'ON_NOEXEC');

CREATE TYPE "JobType" AS ENUM ('AUTOSYS', 'FMC', 'DATABASE', 'INSTRUMENTED');

CREATE TABLE "public"."Group" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"name" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Dashboard" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"name" text  NOT NULL ,
"published" boolean  NOT NULL DEFAULT false,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"email" text  NOT NULL ,
"groupId" integer   ,
"id" SERIAL,
"name" text   ,
"password" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Section" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"dashboardId" integer   ,
"id" SERIAL,
"name" text  NOT NULL ,
"order" integer   ,
"published" boolean  NOT NULL DEFAULT false,
"successCriteria" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Step" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"jobId" integer  NOT NULL ,
"name" text  NOT NULL ,
"order" integer   ,
"sectionId" integer  NOT NULL ,
"successCriteria" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."JournalEntry" (
"entry" text   ,
"id" SERIAL,
"stepId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Job" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"jobType" "JobType"  DEFAULT E'AUTOSYS',
"joid" integer   ,
"name" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."JobRun" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"endTime" timestamp(3)   ,
"exitCode" integer   ,
"id" SERIAL,
"jobId" integer  NOT NULL ,
"jobRunId" integer   ,
"joid" integer   ,
"moreInfo" text   ,
"startTime" timestamp(3)  NOT NULL ,
"status" "JobStatus"  ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_DashboardToGroup" (
"A" integer  NOT NULL ,
"B" integer  NOT NULL )

CREATE UNIQUE INDEX "Group.name" ON "public"."Group"("name")

CREATE UNIQUE INDEX "Dashboard.name" ON "public"."Dashboard"("name")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Section.name" ON "public"."Section"("name")

CREATE UNIQUE INDEX "Step.name" ON "public"."Step"("name")

CREATE UNIQUE INDEX "Job.name" ON "public"."Job"("name")

CREATE UNIQUE INDEX "Job.joid" ON "public"."Job"("joid")

CREATE UNIQUE INDEX "_DashboardToGroup_AB_unique" ON "public"."_DashboardToGroup"("A","B")

CREATE  INDEX "_DashboardToGroup_B_index" ON "public"."_DashboardToGroup"("B")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("groupId")REFERENCES "public"."Group"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Section" ADD FOREIGN KEY ("dashboardId")REFERENCES "public"."Dashboard"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Step" ADD FOREIGN KEY ("jobId")REFERENCES "public"."Job"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Step" ADD FOREIGN KEY ("sectionId")REFERENCES "public"."Section"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."JournalEntry" ADD FOREIGN KEY ("stepId")REFERENCES "public"."Step"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."JobRun" ADD FOREIGN KEY ("jobId")REFERENCES "public"."Job"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_DashboardToGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."Dashboard"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_DashboardToGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."Group"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200716220821-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,137 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Group {
+  id         Int         @default(autoincrement()) @id
+  name       String      @unique
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  dashboards Dashboard[] @relation(references: [id])
+  users      User[]
+}
+
+model Dashboard {
+  id        Int       @default(autoincrement()) @id
+  name      String    @unique
+  groups    Group[]   @relation(references: [id])
+  sections  Section[]
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  published Boolean   @default(false)
+}
+
+model User {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  email     String   @unique
+  name      String?
+  password  String
+  group     Group?   @relation(fields: [groupId], references: [id])
+  groupId   Int?
+}
+
+model Section {
+  id              Int        @default(autoincrement()) @id
+  name            String     @unique
+  createdAt       DateTime   @default(now())
+  updatedAt       DateTime   @updatedAt
+  published       Boolean    @default(false)
+  order           Int?
+  successCriteria String?
+  dashboard       Dashboard? @relation(fields: [dashboardId], references: [id])
+  dashboardId     Int?
+  steps           Step[]
+}
+
+model Step {
+  id              Int            @default(autoincrement()) @id
+  name            String         @unique
+  createdAt       DateTime       @default(now())
+  updatedAt       DateTime       @updatedAt
+  job             Job            @relation(fields: [jobId], references: [id])
+  jobId           Int
+  order           Int?
+  successCriteria String?
+  journalEntries  JournalEntry[]
+  section         Section        @relation(fields: [sectionId], references: [id])
+  sectionId       Int
+}
+
+model JournalEntry {
+  id     Int     @default(autoincrement()) @id
+  entry  String?
+  step   Step    @relation(fields: [stepId], references: [id])
+  stepId Int
+  // author   User    @relation(fields: [authorId], references: [id])
+  // authorId String
+}
+
+model Job {
+  id        Int      @default(autoincrement()) @id
+  name      String   @unique
+  joid      Int?     @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  runs      JobRun[]
+  jobType   JobType? @default(AUTOSYS)
+  Step      Step[]
+}
+
+model JobRun {
+  id        Int        @default(autoincrement()) @id
+  joid      Int?
+  jobRunId  Int?
+  createdAt DateTime   @default(now())
+  updatedAt DateTime   @updatedAt
+  startTime DateTime
+  endTime   DateTime?
+  status    JobStatus?
+  job       Job        @relation(fields: [jobId], references: [id])
+  jobId     Int
+  exitCode  Int?
+  moreInfo  String?
+}
+
+enum JobStatus {
+  RUNNING
+  STARTING
+  SUCCESS
+  FAILURE
+  TERMINATED
+  ON_ICE
+  INACTIVE
+  ACTIVATED
+  RESTART
+  ON_HOLD
+  QUE_WAIT
+  WAIT_REPLY
+  PEND_MACH
+  RESWAIT
+  ON_NOEXEC
+}
+
+enum JobType {
+  AUTOSYS
+  FMC
+  DATABASE
+  INSTRUMENTED
+}
+
+// model SectionsOnDashboards {
+//   dashboard   Dashboard @relation(fields: [dashboardId], references: [id])
+//   dashboardId Int
+//   section     Section   @relation(fields: [sectionId], references: [id])
+//   sectionId   Int
+//   createdAt   DateTime  @default(now())
+//   updatedAt   DateTime  @updatedAt
+//   order       Int?
+//   sla         Int?
+//   alias       String?
+//   @@id([sectionId, dashboardId])
+// }
```


